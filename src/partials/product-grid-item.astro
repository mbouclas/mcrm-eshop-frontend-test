---
import {getProductColors} from "@helpers/colors";
import {config} from "@data/config";
import {moneyFormat} from "@helpers/money-format";
import {optimizeCloudinaryImage} from "../helpers/cloudinary.helper";
import AddToCartButton from '@components/add-to-cart-button.component.svelte';

const {item, allColors} = Astro.props;

const colors = getProductColors(allColors, item.variants.filter(variant => variant.color && variant.image));
// console.log(colors.filter(c => c.image))
function slimDownProduct(item) {
    return {
        id: item.id,
        title: item.title,
    }
}
---
<div class=" relative flex flex-col overflow-hidden rounded-lg border border-gray-200 bg-white">
    <div class="aspect-h-4 aspect-w-3 bg-gray-200 sm:aspect-none group-hover:opacity-75 sm:h-96">
<img  src={item.thumb ? optimizeCloudinaryImage(item.thumb, 360) : config.defaultNoImage}
     alt={item.title}
     title={item.title}
     width="158"
     height="158"
             class="h-full w-full object-cover object-center sm:h-full sm:w-full">
    </div>
    <div class="flex flex-1 flex-col space-y-2 p-4 bg-gray-50">
        <h3 class="text-sm font-medium text-gray-900">
            <a href={`/product/${item.sku}/${item.slug}`} title={item.title}>
                <span aria-hidden="true" class=" inset-0"></span>
                {item.title}
            </a>
        </h3>
        <div class="w-full grid grid-cols-5 px-3">
            {colors.map(color => (

                    <a href="#" data-image={color.image} @click.prevent="selectVariant(color)">
                    <div class={`h-6 w-6 border border-[${color.color}] flex rounded-full items-center justify-center`}
                         style={`border-color:${color.color}`}>
                        <div class={`h-3 w-3 rounded-full`} style={`background-color:${color.color}`}></div>
                    </div>
                    </a>
            ))}

    </div>
        <div class="flex flex-1 flex-col justify-end">
            {colors.length > 0 && (
            <p class="text-sm italic text-gray-500">{colors.length} {colors.length === 1 ? 'color' : 'colors'}</p>
            )}
            <p class="text-base font-medium text-gray-900">{moneyFormat(item.price)}</p>
        </div>
        {/*
        <button type="submit" class="mt-8 flex w-full items-center justify-center rounded-md border border-transparent bg-indigo-600 px-8 py-3 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Add to cart</button>
*/}
        <AddToCartButton item={slimDownProduct(item)} client:idle />
</div>
{/*
<div class="flex items-center flex-col justify-between">
    <a href={`/product/${item.sku}/${item.slug}`}>
        <img
                src={item.thumb} alt={item.title}
                alt={item.title}
                title={item.title}
                width="158"
                height="158"
        />
    </a>
</div>
<div class="w-full">
    <h4 class="text-lg mt-2 font-bold text-black">
        {item.title}
    </h4>
    <p class="text-sm text-gray-500 mt-2">{item.description}</p>

</div>
<div class="group relative flex flex-col overflow-hidden rounded-lg border border-gray-200 bg-white">
    <div class="flex-1">
        <div class="w-full grid grid-cols-5 px-3">
            {getProductColors(item.properties).map(color => (

                    <div class={`h-6 w-6 border border-[${color}] flex rounded-full items-center justify-center`}
                         style={`border-color:${color}`}>
                        <div class={`h-3 w-3 rounded-full`} style={`background-color:${color}`}></div>
                    </div>
            ))}


        </div>
    </div>
    <div class="flex items-center">
        <p></p>
        <span class="ml-[1px] text-xl">
                  <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-5 w-5"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                          stroke-width="2"
                  >
                    <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M19 9l-7 7-7-7"></path>
                  </svg>
                </span>
    </div>
</div>
*/}
